import{h as e,r as a,j as l,y as t,q as s,u as o,o as n,c as r,w as c,i as u,a as i,f as d,t as p,k as m,v as f,x as v,I as h,e as x}from"./index-3df494fb.js";import{b as y}from"./uni-app.es.b1e62a0a.js";import{c as g,v as w,a as _}from"./user.e0035ac6.js";import{_ as b}from"./_plugin-vue_export-helper.6fa35add.js";const V=b({__name:"setPassWord",setup(b){const V=e(!1),k=e(0),I=e({img:"",key:""}),j=a({mobile:"",invite_mobile:"",verify:"",password:"",realPassword:"",captcha:""}),P=e(!1);y((()=>{clearInterval(globalThis.inter)})),l((()=>{T(),j.mobile=t("userInfo").mobile,P.value=0==t("userInfo").is_set_transaction_password}));const T=()=>{s({mask:!0}),g({type:"register"}).then((({data:e})=>{I.value=e.url,o()}))},U=async()=>{if(11!==j.mobile.trim().length)return f({title:"请输入正确的手机号",icon:"none"}),!1;if(!j.captcha)return f({title:"请输入正确的算式结果",icon:"none"}),!1;try{const{data:e}=await w({key:I.value.key,type:"register",captcha:j.captcha});f({title:"验证码发送成功",icon:"none"}),V.value=!0,k.value=60,globalThis.inter=setInterval((()=>{console.log(k.value),k.value-=1,0==k.value&&(clearInterval(globalThis.inter),V.value=!1)}),1e3)}catch(e){setTimeout((()=>{T()}),1e3)}},C=async()=>{if(j.password!=j.realPassword)return f({title:"两次密码输入不匹配",icon:"none"}),!1;const e={mobile:j.mobile,password:j.password,verify:null==j?void 0:j.captcha};console.log(e),await _(e),f({title:"密码修改成功"}),setTimeout((()=>{v()}),1e3)};return(e,a)=>{const l=h,t=u,s=x;return n(),r(t,{class:"page flex-column-start-center"},{default:c((()=>[P.value?m("",!0):(n(),r(t,{key:0,class:"input-area flex-start-center-nowrap"},{default:c((()=>[i(l,{name:"account",class:"input flex-1",type:"text",maxlength:"11",placeholder:"手机号",disabled:"",modelValue:j.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>j.mobile=e)},null,8,["modelValue"]),V.value?(n(),r(t,{key:1,class:"get-code get"},{default:c((()=>[d(p(k.value)+"s",1)])),_:1})):(n(),r(t,{key:0,class:"get-code gray",onClick:U},{default:c((()=>[d("获取验证码")])),_:1}))])),_:1})),P.value?m("",!0):(n(),r(t,{key:1,class:"flex-start-center-nowrap"},{default:c((()=>[i(t,{class:"input-area flex-start-center-nowrap",style:{width:"384rpx"}},{default:c((()=>[i(l,{name:"account",modelValue:j.captcha,"onUpdate:modelValue":a[1]||(a[1]=e=>j.captcha=e),class:"input flex-1",type:"text",maxlength:"11",placeholder:"请输入图中算式结果"},null,8,["modelValue"])])),_:1}),i(s,{class:"verify",mode:"widthFix",src:I.value.img,onClick:T},null,8,["src"])])),_:1})),P.value?m("",!0):(n(),r(t,{key:2,class:"input-area flex-start-center-nowrap"},{default:c((()=>[i(l,{name:"account",class:"input flex-1",type:"text",maxlength:"11",placeholder:"验证码",modelValue:j.verify,"onUpdate:modelValue":a[2]||(a[2]=e=>j.verify=e)},null,8,["modelValue"])])),_:1})),i(t,{class:"input-area flex-start-center-nowrap"},{default:c((()=>[i(l,{name:"account",class:"input flex-1",type:"text",maxlength:"11",placeholder:"密码",modelValue:j.password,"onUpdate:modelValue":a[3]||(a[3]=e=>j.password=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"input-area flex-start-center-nowrap"},{default:c((()=>[i(l,{name:"account",class:"input flex-1",type:"text",maxlength:"11",placeholder:"确定密码",modelValue:j.realPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>j.realPassword=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"btn",onClick:C},{default:c((()=>[d("提交")])),_:1})])),_:1})}}},[["__scopeId","data-v-dae538e3"]]);export{V as default};
