import{_ as e,u as a,r as l,f as t,z as s,v as i,A as n,B as r,a as o,w as c,i as u,o as m,b as p,d,t as g,h as f,j as _,F as y,e as b,x as h,p as v,y as x,C as w,k,I as V,D as $,S as C}from"./index-DV5gXwyS.js";import{_ as j,a as U,b as I}from"./show.B0O9Pu_2.js";import{_ as T,a as F,b as P}from"./plus.BTaRIcsN.js";import{a as z,o as A,b as L}from"./uni-app.es.iHn-elbW.js";import{c as N,v as Z,r as M}from"./user.DOE48SVR.js";import{u as O}from"./request.8kQxyx6u.js";const R=e({__name:"register",setup(e){const{t:R}=a(),S=l(!1),q=l(0),B=t({nick_name:"",mobile:"",invite_mobile:"",verify:"",password:"",realPassword:"",captcha:"",name:"",nation:"",certificate_type:null,real_name:"",id_number:"",certificate_image:[]}),D=l(!1),E=l(!1),G=l({img:"",key:""}),H=l([]);z((e=>{s("invite_mobile")&&(B.invite_mobile=s("invite_mobile"));var a=s("m_info");5==a.is_disabled&&(B.mobile=a.mobile,B.real_name=a.real_name,B.id_number=a.id_number,B.invite_mobile=a.pid_number)})),i((()=>{W()})),A((()=>{const{certificate_type_name:e}=s("localeList");let a=[];for(let l in e)console.log(l),a.push({key:l,name:e[l]});H.value=a,console.log(q.value,e)}));const J=e=>{B.certificate_type=e.detail.value},K=async()=>{if(console.log(R("login.register.regMobile")),!B.mobile.match(/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(.[a-zA-Z0-9_-]+)+$/))return h({title:R("login.register.regMobile"),icon:"none"}),!1;if(!B.captcha)return h({title:R("login.register.regCaptcha"),icon:"none"}),!1;try{const{data:e}=await Z({mobile:B.mobile,key:G.value.key,type:"register",captcha:B.captcha});h({title:R("login.register.sendSucess"),icon:"none"}),S.value=!0,q.value=60,globalThis.inter=setInterval((()=>{q.value-=1,0==q.value&&(clearInterval(globalThis.inter),S.value=!1)}),1e3)}catch(e){setTimeout((()=>{W()}),1e3)}};L((()=>{clearInterval(globalThis.inter)}));const Q=async()=>{let e={},a=Object.keys(s("localeList").nation),l=Object.values(s("localeList").nation);for(let s in a)e[l[s]]=a[s];let t=e[s("locale").country];if(console.log("国家id:",t,e),B.password!=B.realPassword)return h({title:R("login.register.faillPass"),icon:"none"}),!1;if(0==B.invite_mobile.length)return h({title:R("login.register.pelaseInput"),icon:"none"}),!1;if(null==B.certificate_type)return h({title:R("login.register.pelaseCertificateType"),icon:"none"}),!1;if(0==B.real_name.length)return h({title:R("login.register.pelaseRealName"),icon:"none"}),!1;if(0==B.id_number.length)return h({title:R("login.register.pelaseIdNumber"),icon:"none"}),!1;if(0==B.certificate_image.length)return h({title:R("login.register.pelaseUploadFile"),icon:"none"}),!1;const i={mobile:B.mobile,invite_mobile:B.invite_mobile,password:B.password,verify:B.captcha,nation:t,name:B.nick_name,certificate_type:H.value[B.certificate_type].key,real_name:B.real_name,id_number:B.id_number,certificate_image:B.certificate_image.join(",")};return console.log(i),await M(i),v("m_info",""),h({title:R("login.register.success"),icon:"none",duration:3e3}),setTimeout((()=>{x({url:"/pages/login/login"})}),3e3),!1},W=()=>{n({mask:!0}),N({type:"register",mobile:B.mobile}).then((({data:e})=>{G.value=e.url,r()}))},X=()=>{w({mediaType:["image"],count:5-B.certificate_image.length,success:async e=>{console.log(e);for(let a of e.tempFilePaths){let e=await O(a);console.log(e.data),B.certificate_image.push(e.data.image_url)}}})};return(e,a)=>{const l=u,t=k,s=V,i=$,n=C;return m(),o(l,{class:"page flex-column-center-center"},{default:c((()=>[p(n,{"scroll-y":"",class:"scroll"},{default:c((()=>[p(l,{class:"title"},{default:c((()=>[d(g(e.$t("login.register.title")),1)])),_:1}),p(l,{class:"input-area flex-start-center-nowrap"},{default:c((()=>[p(l,{class:"icon"},{default:c((()=>[p(t,{class:"image",src:j})])),_:1}),p(s,{name:"account",modelValue:B.invite_mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>B.invite_mobile=e),class:"input flex-1",type:"text",placeholder:e.$t("login.register.invite_mobile")},null,8,["modelValue","placeholder"])])),_:1}),p(l,{class:"input-area flex-start-center-nowrap"},{default:c((()=>[p(l,{class:"icon"},{default:c((()=>[p(t,{class:"image",src:T})])),_:1}),p(s,{name:"account",class:"input flex-1",modelValue:B.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>B.mobile=e),type:"text",placeholder:e.$t("login.register.mobile")},null,8,["modelValue","placeholder"])])),_:1}),p(l,{class:"flex-start-center-nowrap"},{default:c((()=>[p(l,{class:"input-area flex-start-center-nowrap",style:{width:"384rpx"}},{default:c((()=>[p(s,{name:"account",modelValue:B.captcha,"onUpdate:modelValue":a[2]||(a[2]=e=>B.captcha=e),class:"input flex-1",type:"text",maxlength:"11",placeholder:e.$t("login.register.captcha")},null,8,["modelValue","placeholder"])])),_:1}),p(t,{class:"verify",mode:"widthFix",src:G.value.img,onClick:W},null,8,["src"])])),_:1}),p(l,{class:"input-area flex-start-center-nowrap"},{default:c((()=>[p(l,{class:"icon"},{default:c((()=>[p(t,{class:"image",src:F})])),_:1}),p(s,{name:"account",modelValue:B.verify,"onUpdate:modelValue":a[3]||(a[3]=e=>B.verify=e),class:"input flex-1",type:"text",maxlength:"11",placeholder:e.$t("login.register.verify")},null,8,["modelValue","placeholder"]),S.value?(m(),o(l,{key:1,class:"get-code get"},{default:c((()=>[d(g(q.value)+"s",1)])),_:1})):(m(),o(l,{key:0,class:"get-code gray",onClick:K},{default:c((()=>[d(g(e.$t("login.register.getVerify")),1)])),_:1}))])),_:1}),p(l,{class:"input-area flex-start-center-nowrap"},{default:c((()=>[p(l,{class:"icon"},{default:c((()=>[p(t,{class:"image",src:U})])),_:1}),p(s,{name:"account",modelValue:B.password,"onUpdate:modelValue":a[4]||(a[4]=e=>B.password=e),class:"input flex-1",type:D.value?"text":"password",maxlength:"12",placeholder:e.$t("login.register.password")},null,8,["modelValue","type","placeholder"]),p(l,{class:"icon",onClick:a[5]||(a[5]=e=>D.value=!D.value)},{default:c((()=>[p(t,{class:"image",src:I})])),_:1})])),_:1}),p(l,{class:"input-area flex-start-center-nowrap"},{default:c((()=>[p(l,{class:"icon"},{default:c((()=>[p(t,{class:"image",src:U})])),_:1}),p(s,{name:"account",modelValue:B.realPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>B.realPassword=e),class:"input flex-1",type:E.value?"text":"password",maxlength:"12",placeholder:e.$t("login.register.password")},null,8,["modelValue","type","placeholder"]),p(l,{class:"icon",onClick:a[7]||(a[7]=e=>E.value=!E.value)},{default:c((()=>[p(t,{class:"image",src:I})])),_:1})])),_:1}),p(l,{class:"input-area flex-start-center-nowrap relative"},{default:c((()=>[p(l,{class:"icon"},{default:c((()=>[p(t,{class:"image",src:j})])),_:1}),p(s,{name:"account",modelValue:B.real_name,"onUpdate:modelValue":a[8]||(a[8]=e=>B.real_name=e),class:"input flex-1",type:"text",placeholder:e.$t("login.register.pelaseRealName")},null,8,["modelValue","placeholder"]),p(l,{style:{"font-size":"24rpx",position:"absolute",bottom:"-50rpx",left:"120rpx",color:"#888"}},{default:c((()=>[d(g(e.$t("login.register.real_name")),1)])),_:1})])),_:1}),p(l,{class:"input-area flex-start-center-nowrap"},{default:c((()=>[p(l,{class:"icon"},{default:c((()=>[p(t,{class:"image",src:j})])),_:1}),p(i,{class:"input flex-1",range:H.value,"range-key":"name",onChange:J},{default:c((()=>[null!=B.certificate_type?(m(),o(l,{key:0,class:"input"},{default:c((()=>[d(g(H.value[B.certificate_type].name),1)])),_:1})):(m(),o(l,{key:1,class:"input placeholder"},{default:c((()=>[d(g(e.$t("login.register.certificate_type")),1)])),_:1}))])),_:1},8,["range"])])),_:1}),p(l,{class:"input-area flex-start-center-nowrap"},{default:c((()=>[p(l,{class:"icon"},{default:c((()=>[p(t,{class:"image",src:j})])),_:1}),p(s,{name:"account",modelValue:B.id_number,"onUpdate:modelValue":a[9]||(a[9]=e=>B.id_number=e),class:"input flex-1",type:"text",placeholder:e.$t("login.register.id_number")},null,8,["modelValue","placeholder"])])),_:1}),p(l,{class:"upload-area flex-row-start-center-wrap"},{default:c((()=>[(m(!0),f(y,null,_(B.certificate_image,((e,a)=>(m(),o(t,{class:"upload",key:a,src:e,mode:"aspectFill"},null,8,["src"])))),128)),5!=B.certificate_image.length?(m(),o(l,{key:0,class:"upload flex-center-center-wrap",onClick:X},{default:c((()=>[p(t,{class:"image",src:P,mode:"widthFix"})])),_:1})):b("",!0)])),_:1}),p(l,{class:"btn",onClick:Q},{default:c((()=>[d(g(e.$t("login.register.post")),1)])),_:1}),p(l,{class:"btn line flex-center-center",onClick:a[10]||(a[10]=a=>e.toUrl("/pages/login/login"))},{default:c((()=>[d(g(e.$t("login.register.backLogin")),1)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-d4f97935"]]);export{R as default};
